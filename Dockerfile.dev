FROM node:20-bullseye AS base
WORKDIR /workspace
ENV CI=1
RUN corepack enable

# Copy only manifests to leverage caching (add more package.json paths as needed)
COPY package.json yarn.lock ./
COPY apps/api/package.json apps/api/
COPY packages/**/package.json packages/**/

# Yarn cache speeds things up between builds
RUN --mount=type=cache,target=/root/.cache/yarn \
    yarn install --frozen-lockfile

COPY apps/api/prisma apps/api/prisma
RUN npx prisma generate --schema=apps/api/prisma/schema.prisma

FROM base AS dev
WORKDIR /workspace
CMD ["yarn","dev:api"]

